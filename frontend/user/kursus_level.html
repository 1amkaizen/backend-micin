<!-- frontend/user/kursus_level.html -->
{% extends "base.html" %}

{% block content %}
<h1 style="margin-bottom: 20px;">Modul Kursus - Level {{ level }}</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
  {% for modul in modules %}
    <div style="border: 1px solid #ccc; padding: 10px; border-radius: 8px; background: #f9f9f9;">
      <h3 style="margin-bottom: 10px;">
        {{ modul.order_index }}. {{ modul.title }}
        {% if modul.is_completed %}
          <span style="color: limegreen; font-size: 24px;">‚úîÔ∏è</span>
        {% elif not modul.is_unlocked %}
          <span style="color: gray; font-size: 20px;">üîí Terkunci</span>
        {% endif %}
      </h3>

      {% if modul.is_unlocked %}
        <div class="video-wrapper">
          <iframe
            src="{{ modul.video_url }}"
            width="100%"
            height="240"
            frameborder="0"
            allow="autoplay; fullscreen"
            allowfullscreen
            data-module-id="{{ modul.id }}">
          </iframe>
        </div>
      {% else %}
        <div style="color: #777; font-style: italic; margin-top: 20px;">
          Selesaikan modul sebelumnya untuk membuka video ini.
        </div>
      {% endif %}
    </div>
  {% endfor %}
</div>
<div id="ujian-section" style="margin-top: 40px; text-align: center;"></div>

<script>
const level = "{{ level }}";
fetch(`/ujian/cek/${level}`)
  .then(res => res.json())
  .then(data => {
    if (data.boleh_ujian) {
      const div = document.getElementById("ujian-section");
      const button = document.createElement("a");
      button.href = `/ujian/${level}`;
      button.textContent = "üéì Mulai Ujian Akhir";
      button.style = `
        display: inline-block;
        padding: 10px 20px;
        background: darkgreen;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: bold;
      `;
      div.appendChild(button);
    }
  });
</script>

<script src="https://player.vimeo.com/api/player.js"></script>
<script src="/static/js/progress.js"></script>
{% endblock %}
